<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Android-ANR分析解决方法 | </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.4">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    
    <link rel="prev" href="../ANR/index.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="1.1"
        data-chapter-title="Android-ANR分析解决方法"
        data-filepath="ANR/Android-ANR分析解决方法.md"
        data-basepath=".."
        data-revision="Tue May 10 2016 23:18:22 GMT+0800 (CST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="ANR/index.html">
            
                
                    <a href="../ANR/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        ANR
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.1" data-path="ANR/Android-ANR分析解决方法.html">
            
                
                    <a href="../ANR/Android-ANR分析解决方法.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Android-ANR分析解决方法
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" ></a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="android-anr-&#x5206;&#x6790;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;">Android ANR &#x5206;&#x6790;&#x89E3;&#x51B3;&#x65B9;&#x6CD5;</h1>
<p>&#x6765;&#x6E90;:<a href="http://www.cnblogs.com/purediy/archive/2013/07/30/3225060.html" target="_blank">www.cnblogs.com</a></p>
<h2 id="&#x4E00;&#xFF1A;&#x4EC0;&#x4E48;&#x662F;anr">&#x4E00;&#xFF1A;&#x4EC0;&#x4E48;&#x662F;ANR</h2>
<p>ANR:Application Not Responding&#xFF0C;&#x5373;&#x5E94;&#x7528;&#x65E0;&#x54CD;&#x5E94;</p>
<h2 id="&#x4E8C;&#xFF1A;anr&#x7684;&#x7C7B;&#x578B;">&#x4E8C;&#xFF1A;ANR&#x7684;&#x7C7B;&#x578B;</h2>
<p>ANR&#x4E00;&#x822C;&#x6709;&#x4E09;&#x79CD;&#x7C7B;&#x578B;&#xFF1A;</p>
<ul>
<li>1&#x3001;<strong>KeyDispatchTimeout(5 seconds)</strong> --&#x4E3B;&#x8981;&#x7C7B;&#x578B;&#x6309;&#x952E;&#x6216;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;&#x5728;&#x7279;&#x5B9A;&#x65F6;&#x95F4;&#x5185;&#x65E0;&#x54CD;&#x5E94;</li>
<li>2&#x3001;<strong>BroadcastTimeout(10 seconds)</strong> --BroadcastReceiver&#x5728;&#x7279;&#x5B9A;&#x65F6;&#x95F4;&#x5185;&#x65E0;&#x6CD5;&#x5904;&#x7406;&#x5B8C;&#x6210;</li>
<li>3&#x3001;<strong>ServiceTimeout(20 seconds)</strong> --&#x5C0F;&#x6982;&#x7387;&#x7C7B;&#x578B; Service&#x5728;&#x7279;&#x5B9A;&#x7684;&#x65F6;&#x95F4;&#x5185;&#x65E0;&#x6CD5;&#x5904;&#x7406;&#x5B8C;&#x6210;</li>
</ul>
<h2 id="&#x4E09;&#xFF1A;keydispatchtimeout">&#x4E09;&#xFF1A;KeyDispatchTimeout</h2>
<p><em>A key or touch event was not dispatched within the specified time</em>&#xFF08;&#x6309;&#x952E;&#x6216;&#x89E6;&#x6478;&#x4E8B;&#x4EF6;&#x5728;&#x7279;&#x5B9A;&#x65F6;&#x95F4;&#x5185;&#x65E0;&#x54CD;&#x5E94;&#xFF09;</p>
<p>&#x5177;&#x4F53;&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x7684;&#x5B9A;&#x4E49;&#x5728;framework&#x4E0B;&#x7684;<code>ActivityManagerService.java</code></p>
<pre><code>//How long we wait until we timeout on key dispatching.

static final int KEY_DISPATCHING_TIMEOUT = 5*1000
</code></pre><h2 id="&#x56DB;&#xFF1A;&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x8D85;&#x65F6;&#x5462;&#xFF1F;">&#x56DB;&#xFF1A;&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x8D85;&#x65F6;&#x5462;&#xFF1F;</h2>
<p>&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x7684;&#x8BA1;&#x6570;&#x4E00;&#x822C;&#x662F;&#x4ECE;&#x6309;&#x952E;&#x5206;&#x53D1;&#x7ED9;app&#x5F00;&#x59CB;&#x3002;&#x8D85;&#x65F6;&#x7684;&#x539F;&#x56E0;&#x4E00;&#x822C;&#x6709;&#x4E24;&#x79CD;&#xFF1A;</p>
<p>(1)&#x5F53;&#x524D;&#x7684;&#x4E8B;&#x4EF6;&#x6CA1;&#x6709;&#x673A;&#x4F1A;&#x5F97;&#x5230;&#x5904;&#x7406;&#xFF08;&#x5373;UI&#x7EBF;&#x7A0B;&#x6B63;&#x5728;&#x5904;&#x7406;&#x524D;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#xFF0C;&#x6CA1;&#x6709;&#x53CA;&#x65F6;&#x7684;&#x5B8C;&#x6210;&#x6216;&#x8005;looper&#x88AB;&#x67D0;&#x79CD;&#x539F;&#x56E0;&#x963B;&#x585E;&#x4F4F;&#x4E86;&#xFF09;</p>
<p>(2)&#x5F53;&#x524D;&#x7684;&#x4E8B;&#x4EF6;&#x6B63;&#x5728;&#x5904;&#x7406;&#xFF0C;&#x4F46;&#x6CA1;&#x6709;&#x53CA;&#x65F6;&#x5B8C;&#x6210;</p>
<h2 id="&#x4E94;&#xFF1A;&#x5982;&#x4F55;&#x907F;&#x514D;keydispatchtimeout">&#x4E94;&#xFF1A;&#x5982;&#x4F55;&#x907F;&#x514D;KeyDispatchTimeout</h2>
<ul>
<li><p>1&#x3001;UI&#x7EBF;&#x7A0B;&#x5C3D;&#x91CF;&#x53EA;&#x505A;&#x8DDF;UI&#x76F8;&#x5173;&#x7684;&#x5DE5;&#x4F5C;</p>
</li>
<li><p>2&#x3001;&#x8017;&#x65F6;&#x7684;&#x5DE5;&#x4F5C;&#xFF08;&#x6BD4;&#x5982;&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;&#xFF0C;I/O&#xFF0C;&#x8FDE;&#x63A5;&#x7F51;&#x7EDC;&#x6216;&#x8005;&#x522B;&#x7684;&#x6709;&#x53EF;&#x80FD;&#x963B;&#x788D;UI&#x7EBF;&#x7A0B;&#x7684;&#x64CD;&#x4F5C;&#xFF09;&#x628A;&#x5B83;&#x653E;&#x5165;&#x5355;&#x72EC;&#x7684;&#x7EBF;&#x7A0B;&#x5904;&#x7406;</p>
</li>
<li><p>3&#x3001;&#x5C3D;&#x91CF;&#x7528;Handler&#x6765;&#x5904;&#x7406;UIthread&#x548C;&#x522B;&#x7684;thread&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x4E92;</p>
</li>
</ul>
<h2 id="&#x516D;&#xFF1A;ui&#x7EBF;&#x7A0B;">&#x516D;&#xFF1A;UI&#x7EBF;&#x7A0B;</h2>
<p>&#x8BF4;&#x4E86;&#x90A3;&#x4E48;&#x591A;&#x7684;UI&#x7EBF;&#x7A0B;&#xFF0C;&#x90A3;&#x4E48;&#x54EA;&#x4E9B;&#x5C5E;&#x4E8E;UI&#x7EBF;&#x7A0B;&#x5462;&#xFF1F;</p>
<p>UI&#x7EBF;&#x7A0B;&#x4E3B;&#x8981;&#x5305;&#x62EC;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li><p>1&#x3001;Activity:onCreate(), onResume(), onDestroy(), onKeyDown(), onClick(),etc</p>
</li>
<li><p>2&#x3001;AsyncTask: onPreExecute(), onProgressUpdate(), onPostExecute(), onCancel,etc</p>
</li>
<li><p>3&#x3001;Mainthread handler: handleMessage(), post*(runnable r), etc</p>
</li>
<li><p>4&#x3001;other</p>
</li>
</ul>
<h2 id="&#x4E03;&#x5982;&#x4F55;&#x53BB;&#x5206;&#x6790;anr">&#x4E03;:&#x5982;&#x4F55;&#x53BB;&#x5206;&#x6790;ANR</h2>
<p>&#x5148;&#x770B;&#x4E2A;LOG:   </p>
<pre><code>04-01 13:12:11.572 I/InputDispatcher( 220): Application is not responding:Window{2b263310com.android.email/com.android.email.activity.SplitScreenActivitypaused=false}.
    5009.8ms since event, 5009.5ms since waitstarted
    04-0113:12:11.572 I/WindowManager( 220): Input event 
    dispatching timedout sending 
    tocom.android.email/com.android.email.activity.SplitScreenActivity

    04-01 13:12:14.123 I/Process( 220): Sending signal. PID: 21404 SIG: 3---&#x53D1;&#x751F;ANR&#x7684;&#x65F6;&#x95F4;&#x548C;&#x751F;&#x6210;trace.txt&#x7684;&#x65F6;&#x95F4;
    04-01 13:12:14.123 I/dalvikvm(21404):threadid=4: reacting to 
    signal 3 
    &#x2026;&#x2026;
    04-0113:12:15.872 E/ActivityManager( 220): ANR in 
    com.android.email(com.android.email/.activity.SplitScreenActivity)
    04-0113:12:15.872 E/ActivityManager( 220): 
    Reason:keyDispatchingTimedOut 
    04-0113:12:15.872 E/ActivityManager( 220): Load: 8.68 / 8.37 / 8.53
    04-0113:12:15.872 E/ActivityManager( 220): CPUusage from 4361ms to 699ms ago ----CPU&#x5728;ANR&#x53D1;&#x751F;&#x524D;&#x7684;&#x4F7F;&#x7528;&#x60C5;&#x51B5;

    04-0113:12:15.872 E/ActivityManager( 220): 5.5%21404/com.android.email: 1.3% user + 4.1% kernel / faults:
    10 minor
    04-0113:12:15.872 E/ActivityManager( 220): 4.3%220/system_server: 2.7% user + 1.5% kernel / faults: 11
    minor 2 major
    04-0113:12:15.872 E/ActivityManager( 220): 0.9%52/spi_qsd.0: 0% user + 0.9% kernel
    04-0113:12:15.872 E/ActivityManager( 220): 0.5%65/irq/170-cyttsp-: 0% user + 0.5% kernel
    04-0113:12:15.872 E/ActivityManager( 220): 0.5%296/com.android.systemui: 0.5% user + 0% kernel
    04-0113:12:15.872 E/ActivityManager( 220): 100%TOTAL: 4.8% user + 7.6% kernel + 87% iowait
    04-0113:12:15.872 E/ActivityManager( 220): CPUusage from 3697ms to 4223ms later:-- ANR&#x540E;CPU&#x7684;&#x4F7F;&#x7528;&#x91CF;
    04-0113:12:15.872 E/ActivityManager( 220): 25%21404/com.android.email: 25% user + 0% kernel / faults: 191 minor
    04-0113:12:15.872 E/ActivityManager( 220): 16% 21603/__eas(par.hakan: 16% user + 0% kernel
    04-0113:12:15.872 E/ActivityManager( 220): 7.2% 21406/GC: 7.2% user + 0% kernel
    04-0113:12:15.872 E/ActivityManager( 220): 1.8% 21409/Compiler: 1.8% user + 0% kernel
    04-0113:12:15.872 E/ActivityManager( 220): 5.5%220/system_server: 0% user + 5.5% kernel / faults: 1 minor
    04-0113:12:15.872 E/ActivityManager( 220): 5.5% 263/InputDispatcher: 0% user + 5.5% kernel
    04-0113:12:15.872 E/ActivityManager( 220): 32%TOTAL: 28% user + 3.7% kernel
</code></pre><p>&#x4ECE;LOG&#x53EF;&#x4EE5;&#x770B;&#x51FA;ANR&#x7684;&#x7C7B;&#x578B;&#xFF0C;CPU&#x7684;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#xFF0C;&#x5982;&#x679C;CPU&#x4F7F;&#x7528;&#x91CF;&#x63A5;&#x8FD1;100%&#xFF0C;&#x8BF4;&#x660E;&#x5F53;&#x524D;&#x8BBE;&#x5907;&#x5F88;&#x5FD9;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x662F;CPU&#x9965;&#x997F;&#x5BFC;&#x81F4;&#x4E86;ANR</p>
<p>&#x5982;&#x679C;CPU&#x4F7F;&#x7528;&#x91CF;&#x5F88;&#x5C11;&#xFF0C;&#x8BF4;&#x660E;&#x4E3B;&#x7EBF;&#x7A0B;&#x88AB;BLOCK&#x4E86;</p>
<p>&#x5982;&#x679C;IOwait&#x5F88;&#x9AD8;&#xFF0C;&#x8BF4;&#x660E;ANR&#x6709;&#x53EF;&#x80FD;&#x662F;&#x4E3B;&#x7EBF;&#x7A0B;&#x5728;&#x8FDB;&#x884C;I/O&#x64CD;&#x4F5C;&#x9020;&#x6210;&#x7684;</p>
<p>&#x9664;&#x4E86;&#x770B;LOG&#xFF0C;&#x89E3;&#x51B3;ANR&#x8FD8;&#x5F97;&#x9700;&#x8981;trace.txt&#x6587;&#x4EF6;&#xFF0C;</p>
<p>&#x5982;&#x4F55;&#x83B7;&#x53D6;&#x5462;&#xFF1F;&#x53EF;&#x4EE5;&#x7528;&#x5982;&#x4E0B;&#x547D;&#x4EE4;&#x83B7;&#x53D6;</p>
<pre><code>$chmod 777 /data/anr

$rm /data/anr/traces.txt

$ps

$kill -3 PID

adb pull data/anr/traces.txt ./mytraces.txt
</code></pre><p>&#x4ECE;trace.txt&#x6587;&#x4EF6;&#xFF0C;&#x770B;&#x5230;&#x6700;&#x591A;&#x7684;&#x662F;&#x5982;&#x4E0B;&#x7684;&#x4FE1;&#x606F;&#xFF1A;</p>
<pre><code>-----pid 21404 at 2011-04-01 13:12:14 ----- 
  Cmdline: com.android.email

  DALVIK THREADS:
  (mutexes: tll=0tsl=0 tscl=0 ghl=0 hwl=0 hwll=0)
  &quot;main&quot; prio=5 tid=1NATIVE
  | group=&quot;main&quot; sCount=1 dsCount=0obj=0x2aad2248 self=0xcf70
  | sysTid=21404 nice=0 sched=0/0cgrp=[fopen-error:2] 
  handle=1876218976
  atandroid.os.MessageQueue.nativePollOnce(Native Method)
  atandroid.os.MessageQueue.next(MessageQueue.java:119)
  atandroid.os.Looper.loop(Looper.java:110)
  at android.app.ActivityThread.main(ActivityThread.java:3688)
  at java.lang.reflect.Method.invokeNative(Native Method)
  atjava.lang.reflect.Method.invoke(Method.java:507)

  atcom.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:866)
  at 
  com.android.internal.os.ZygoteInit.main(ZygoteInit.java:624)
  at dalvik.system.NativeStart.main(Native Method)
</code></pre><p>&#x8BF4;&#x660E;&#x4E3B;&#x7EBF;&#x7A0B;&#x5728;&#x7B49;&#x5F85;&#x4E0B;&#x6761;&#x6D88;&#x606F;&#x8FDB;&#x5165;&#x6D88;&#x606F;&#x961F;&#x5217;</p>
<h2 id="&#x516B;&#xFF1A;thread&#x72B6;&#x6001;">&#x516B;&#xFF1A;Thread&#x72B6;&#x6001;</h2>
<pre><code>ThreadState (defined at &#x201C;dalvik/vm/thread.h &#x201C;)

    THREAD_UNDEFINED = -1, /* makes enum compatible with int32_t */

    THREAD_ZOMBIE = 0, /* TERMINATED */

    THREAD_RUNNING = 1, /* RUNNABLE or running now */

    THREAD_TIMED_WAIT = 2, /* TIMED_WAITING in Object.wait() */

    THREAD_MONITOR = 3, /* BLOCKED on a monitor */

    THREAD_WAIT = 4, /* WAITING in Object.wait() */

    THREAD_INITIALIZING= 5, /* allocated, not yet running */

    THREAD_STARTING = 6, /* started, not yet on thread list */

    THREAD_NATIVE = 7, /* off in a JNI native method */

    THREAD_VMWAIT = 8, /* waiting on a VM resource */

    THREAD_SUSPENDED = 9, /* suspended, usually by GC or debugger */
</code></pre><h2 id="&#x4E5D;&#xFF1A;&#x5982;&#x4F55;&#x8C03;&#x67E5;&#x5E76;&#x89E3;&#x51B3;anr">&#x4E5D;&#xFF1A;&#x5982;&#x4F55;&#x8C03;&#x67E5;&#x5E76;&#x89E3;&#x51B3;ANR</h2>
<ul>
<li><p>1.&#x9996;&#x5148;&#x5206;&#x6790;log</p>
</li>
<li><p>2.&#x4ECE;trace.txt&#x6587;&#x4EF6;&#x67E5;&#x770B;&#x8C03;&#x7528;stack.</p>
</li>
<li><p>3.&#x770B;&#x4EE3;&#x7801;</p>
</li>
<li><p>4.&#x4ED4;&#x7EC6;&#x67E5;&#x770B;ANR&#x7684;&#x6210;&#x56E0;&#xFF08;iowait?block?memoryleak?&#xFF09;</p>
</li>
</ul>
<h2 id="&#x5341;&#xFF1A;&#x6848;&#x4F8B;">&#x5341;&#xFF1A;&#x6848;&#x4F8B;</h2>
<h3 id="&#x6848;&#x4F8B;1&#xFF1A;&#x5173;&#x952E;&#x8BCD;contentresolver-in-asynctask-onpostexecute-high-iowait">&#x6848;&#x4F8B;1&#xFF1A;&#x5173;&#x952E;&#x8BCD;:ContentResolver in AsyncTask onPostExecute, high iowait</h3>
<p>&#x539F;&#x56E0;&#xFF1A;IOWait&#x5F88;&#x9AD8;&#xFF0C;&#x8BF4;&#x660E;&#x5F53;&#x524D;&#x7CFB;&#x7EDF;&#x5728;&#x5FD9;&#x4E8E;I/O&#xFF0C;&#x56E0;&#x6B64;&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;&#x88AB;&#x963B;&#x585E;</p>
<p>&#x539F;&#x6765;&#xFF1A;</p>
<pre><code>final Message message=Message.restoreMessageWithId(mProviderContext,messageId);
    if(message==null){
    return;
}
Account account=Account.restoreAccountWithId(mProviderContext,message.mAccountKey);
if(account==null){
    return;//isMessagingController returns false for null, but let&apos;s make itclear.
}
if(isMessagingController(account)){
    new Thread(){
        @Override
        public void run(){
        mLegacyController.processPendingActions(message.mAccountKey);
    }}.start();
}
</code></pre><p>&#x89E3;&#x51B3;&#x540E;&#xFF1A;</p>
<pre><code>newThread() {
    finalMessagemessage=Message.restoreMessageWithId(mProviderContext,messageId);
    if(message==null){
        return;
    }
    Accountaccount=Account.restoreAccountWithId(mProviderContext,message.mAccountKey);
    if(account==null){
        return;//isMessagingController returns false for null, but let&apos;s make itclear.
    }
    if(isMessagingController(account)) {
        mLegacyController.processPendingActions(message.mAccountKey);
    }
}.start();
</code></pre><p>&#x5173;&#x4E8E;AsyncTask:<a href="http://developer.android.com/reference/android/os/AsyncTask.html" target="_blank">http://developer.android.com/reference/android/os/AsyncTask.html</a></p>
<h3 id="&#x6848;&#x4F8B;2&#xFF1A;&#x5173;&#x952E;&#x8BCD;&#x5728;ui&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#x7684;&#x8BFB;&#x5199;">&#x6848;&#x4F8B;2&#xFF1A;&#x5173;&#x952E;&#x8BCD;:&#x5728;UI&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#x7684;&#x8BFB;&#x5199;</h3>
<pre><code>ANRin process: com.android.mediascape:PhotoViewer (last incom.android.mediascape:PhotoViewer)
    Annotation:keyDispatchingTimedOut
    CPU usage:
    Load: 6.74 / 6.89 / 6.12
    CPUusage from 8254ms to 3224ms ago:
    ovider.webmedia: 4% = 4% user +0% kernel / faults: 68 minor
    system_server: 2% = 1% user + 0%kernel / faults: 18 minor
    re-initialized&gt;: 0% = 0% user + 0%kernel / faults: 50 minor
    events/0: 0% = 0% user + 0%kernel
    TOTAL:7% = 6% user + 1% kernel

    DALVIKTHREADS:
    &quot;&quot;main&quot;&quot; prio=5 tid=3 NATIVE
    |group=&quot;&quot;main&quot;&quot; sCount=1 dsCount=0 s=Yobj=0x4001b240 self=0xbda8
    | sysTid=2579 nice=0 sched=0/0cgrp=unknown handle=-1343993184
    atorg.apache.harmony.luni.platform.OSNetworkSystem.receiveStreamImpl(NativeMethod)
    atorg.apache.harmony.luni.platform.OSNetworkSystem.receiveStream(OSNetworkSystem.java:478)
    atorg.apache.harmony.luni.net.PlainSocketImpl.read(PlainSocketImpl.java:565)
    atorg.apache.harmony.luni.net.SocketInputStream.read(SocketInputStream.java:87)
    atorg.apache.harmony.luni.internal.net.www.protocol.http.HttpURLConnection$LimitedInputStream.read(HttpURLConnection.java:303)
    atjava.io.InputStream.read(InputStream.java:133)
    atjava.io.BufferedInputStream.fillbuf(BufferedInputStream.java:157)
    atjava.io.BufferedInputStream.read(BufferedInputStream.java:346)
    atandroid.graphics.BitmapFactory.nativeDecodeStream(Native Method)
    atandroid.graphics.BitmapFactory.decodeStream(BitmapFactory.java:459)
    atcom.android.mediascape.activity.PhotoViewerActivity.getPreviewImage(PhotoViewerActivity.java:4465)
    atcom.android.mediascape.activity.PhotoViewerActivity.dispPreview(PhotoViewerActivity.java:4406)
    atcom.android.mediascape.activity.PhotoViewerActivity.access$6500(PhotoViewerActivity.java:125)
    atcom.android.mediascape.activity.PhotoViewerActivity$33$1.run(PhotoViewerActivity.java:4558)
    atandroid.os.Handler.handleCallback(Handler.java:587)
    atandroid.os.Handler.dispatchMessage(Handler.java:92)
    atandroid.os.Looper.loop(Looper.java:123)
    atandroid.app.ActivityThread.main(ActivityThread.java:4370)
    atjava.lang.reflect.Method.invokeNative(Native Method)
    atjava.lang.reflect.Method.invoke(Method.java:521)
    atcom.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:868)
    atcom.android.internal.os.ZygoteInit.main(ZygoteInit.java:626)
    atdalvik.system.NativeStart.main(Native Method)
</code></pre><p>&#x5173;&#x4E8E;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#xFF0C;&#x5728;&#x8BBE;&#x8BA1;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E2A;timeout&#x7684;&#x65F6;&#x95F4;&#x6216;&#x8005;&#x653E;&#x5165;&#x72EC;&#x7ACB;&#x7684;&#x7EBF;&#x7A0B;&#x6765;&#x5904;&#x7406;&#x3002;</p>
<p>&#x5173;&#x4E8E;Handler&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#xFF1A;<a href="http://developer.android.com/reference/android/os/Handler.html" target="_blank">http://developer.android.com/reference/android/os/Handler.html</a></p>
<h3 id="&#x6848;&#x4F8B;3&#xFF1A;&#x5173;&#x952E;&#x8BCD;&#xFF1A;memoryleakthread-leak">&#x6848;&#x4F8B;3&#xFF1A;&#x5173;&#x952E;&#x8BCD;&#xFF1A;Memoryleak/Thread leak</h3>
<pre><code>11-1621:41:42.560 I/ActivityManager( 1190): ANR in process:android.process.acore (last in android.process.acore)
    11-1621:41:42.560 I/ActivityManager( 1190): Annotation:keyDispatchingTimedOut
    11-16 21:41:42.560 I/ActivityManager(1190): CPU usage:
    11-16 21:41:42.560 I/ActivityManager( 1190):Load: 11.5 / 11.1 / 11.09
    11-16 21:41:42.560 I/ActivityManager(1190): CPU usage from 9046ms to 4018ms ago:
    11-16 21:41:42.560I/ActivityManager( 1190): d.process.acore:98%= 97% user + 0% kernel / faults: 1134 minor
    11-16 21:41:42.560I/ActivityManager( 1190): system_server: 0% = 0% user + 0% kernel /faults: 1 minor
    11-16 21:41:42.560 I/ActivityManager( 1190): adbd:0% = 0% user + 0% kernel
    11-16 21:41:42.560 I/ActivityManager(1190): logcat: 0% = 0% user + 0% kernel
    11-16 21:41:42.560I/ActivityManager( 1190): TOTAL:100% = 98% user + 1% kernel

    Cmdline: android.process.acore

    DALVIK THREADS:
    &quot;main&quot;prio=5 tid=3 VMWAIT
    |group=&quot;main&quot; sCount=1 dsCount=0 s=N obj=0x40026240self=0xbda8
    | sysTid=1815 nice=0 sched=0/0 cgrp=unknownhandle=-1344001376
    atdalvik.system.VMRuntime.trackExternalAllocation(NativeMethod)
    atandroid.graphics.Bitmap.nativeCreate(Native Method)
    atandroid.graphics.Bitmap.createBitmap(Bitmap.java:468)
    atandroid.view.View.buildDrawingCache(View.java:6324)
    atandroid.view.View.getDrawingCache(View.java:6178)
    atandroid.view.ViewGroup.drawChild(ViewGroup.java:1541)
    &#x2026;&#x2026;
    atcom.android.internal.policy.impl.PhoneWindow$DecorView.draw(PhoneWindow.java:1830)
    atandroid.view.ViewRoot.draw(ViewRoot.java:1349)
    atandroid.view.ViewRoot.performTraversals(ViewRoot.java:1114)
    atandroid.view.ViewRoot.handleMessage(ViewRoot.java:1633)
    atandroid.os.Handler.dispatchMessage(Handler.java:99)
    atandroid.os.Looper.loop(Looper.java:123)
    atandroid.app.ActivityThread.main(ActivityThread.java:4370)
    atjava.lang.reflect.Method.invokeNative(Native Method)
    atjava.lang.reflect.Method.invoke(Method.java:521)
    atcom.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:868)
    atcom.android.internal.os.ZygoteInit.main(ZygoteInit.java:626)
    atdalvik.system.NativeStart.main(Native Method)

    &quot;Thread-408&quot;prio=5 tid=329 WAIT
    |group=&quot;main&quot; sCount=1 dsCount=0 s=N obj=0x46910d40self=0xcd0548
    | sysTid=10602 nice=0 sched=0/0 cgrp=unknownhandle=15470792
    at java.lang.Object.wait(Native Method)
    -waiting on &lt;0x468cd420&gt; (a java.lang.Object)
    atjava.lang.Object.wait(Object.java:288)
    atcom.android.dialer.CallLogContentHelper$UiUpdaterExecutor$1.run(CallLogContentHelper.java:289)
    atjava.lang.Thread.run(Thread.java:1096)
</code></pre><p>&#x5206;&#x6790;&#xFF1A;</p>
<p><code>at dalvik.system.VMRuntime.trackExternalAllocation(NativeMethod)</code>&#x5185;&#x5B58;&#x4E0D;&#x8DB3;&#x5BFC;&#x81F4;block&#x5728;&#x521B;&#x5EFA;bitmap&#x4E0A;</p>
<pre><code>    **MEMINFO in pid 1360 [android.process.acore] **

            native dalvik other total

            size: 17036 23111 N/A 40147

            allocated: 16484 20675 N/A 37159

            free: 296 2436 N/A 2732
</code></pre><p>&#x89E3;&#x51B3;&#xFF1A;&#x5982;&#x679C;&#x673A;&#x5668;&#x7684;&#x5185;&#x5B58;&#x65CF;&#xFF0C;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x865A;&#x62DF;&#x673A;&#x7684;&#x5185;&#x5B58;&#x4E3A;36M&#x6216;&#x66F4;&#x5927;&#xFF0C;&#x4E0D;&#x8FC7;&#x6700;&#x597D;&#x662F;&#x590D;&#x67E5;&#x4EE3;&#x7801;&#xFF0C;&#x67E5;&#x770B;&#x54EA;&#x4E9B;&#x5185;&#x5B58;&#x6CA1;&#x6709;&#x91CA;&#x653E;</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../ANR/index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: ANR"><i class="fa fa-angle-left"></i></a>
        
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
